version: '3'
services:
  json-server:
    build: ./json-server
    volumes:
      - ./json-server/db.json:/data/db.json
      - ./json-server/routes.json:/data/routes.json
    command: json-server --watch db.json --host 0.0.0.0 --routes routes.json
  sshd:
    image: yasuyuky/ubuntu-ssh:latest
    ports:
      - "2222:22"
    volumes:
      - ./keys/root/id_rsa.pub:/root/.ssh/authorized_keys
    restart: always
  ansible:
    build: ./ansible
    working_dir: /work
    volumes:
      - ./ansible:/work
      - ../ansible/roles:/work/roles
      - ../ansible/templates:/work/templates
      - ../ansible/sectora.sh:/work/sectora.sh
      - ./keys:/work/keys
      - ../target/:/work/target
      - ./ansible/sshconfig:/root/.ssh/config
